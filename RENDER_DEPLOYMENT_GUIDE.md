# üöÄ Guide de d√©ploiement sur Render.com

Ce guide vous accompagne pas √† pas pour d√©ployer votre application NoMoreBooking sur Render.com.

## üìã Pr√©requis

1. **Compte Render.com** : Cr√©ez un compte sur [render.com](https://render.com)
2. **Repository Git** : Votre code doit √™tre sur GitHub, GitLab ou Bitbucket
3. **Dockerfile pr√™t** : Le `Dockerfile.render` est optimis√© pour Render

## üéØ √âtapes de d√©ploiement

### 1. Pr√©parer le repository

```bash
# Ajouter les fichiers √† Git
git add .
git commit -m "Prepare for Render deployment"
git push origin main
```

### 2. Cr√©er la base de donn√©es

1. Connectez-vous √† [render.com](https://render.com)
2. Cliquez sur **"New +"** ‚Üí **"PostgreSQL"**
3. Configurez :
   - **Name** : `no-more-booking-db`
   - **Database Name** : `no_more_book`
   - **User** : `nomorebook_user`
   - **Region** : `Frankfurt` (recommand√© pour l'Europe)
   - **Plan** : `Free` (pour commencer)
4. Cliquez **"Create Database"**

### 3. Cr√©er le service web

1. Cliquez sur **"New +"** ‚Üí **"Web Service"**
2. Connectez votre repository Git
3. Configurez :
   - **Name** : `no-more-booking`
   - **Region** : `Frankfurt`
   - **Branch** : `main`
   - **Environment** : `Docker`
   - **Dockerfile Path** : `Dockerfile.render` (sans le `./`)
   - **Docker Context** : `.` (racine du projet)
   - **Plan** : `Free` (pour commencer)

### 4. Configurer les variables d'environnement

Dans l'onglet **Environment** du service web, ajoutez :

```env
APP_ENV=prod
APP_DEBUG=0
APP_SECRET=[Auto-generated by Render]
DATABASE_URL=[Linked from database]
MAILER_DSN=smtp://bc484694b30f0a:bdc8204781ab57@sandbox.smtp.mailtrap.io:2525
```

**Notes importantes :**
- `APP_SECRET` : Laissez Render le g√©n√©rer automatiquement
- `DATABASE_URL` : Sera li√© automatiquement √† votre base de donn√©es PostgreSQL

### 5. Lier la base de donn√©es

1. Dans la configuration du service web
2. Onglet **Environment**
3. Cliquez **"Add Environment Variable"**
4. Key : `DATABASE_URL`
5. Value : **"From Database"** ‚Üí S√©lectionnez `no-more-booking-db`

### 6. D√©ployer

1. Cliquez **"Create Web Service"**
2. Render va automatiquement :
   - Cloner votre repository
   - Construire l'image Docker
   - D√©ployer l'application
   - Ex√©cuter les migrations

## üîß Configuration avanc√©e

### Utiliser le fichier render.yaml (Recommand√©)

Pour automatiser compl√®tement le d√©ploiement, utilisez le fichier `render.yaml` :

1. Supprimez les services cr√©√©s manuellement
2. Cliquez **"New +"** ‚Üí **"Blueprint"**
3. Connectez votre repository
4. Render d√©tectera automatiquement le `render.yaml`

### Variables d'environnement personnalis√©es

Ajoutez selon vos besoins :

```env
# Sentry (monitoring d'erreurs)
SENTRY_DSN=your-sentry-dsn

# Mails en production
MAILER_DSN=smtp://user:pass@smtp.gmail.com:587

# Stockage d'assets (S3, CloudFlare)
ASSETS_BASE_URL=https://your-cdn.com
```

## üîê S√©curit√© et production

### 1. Mots de passe forts

```env
APP_SECRET=your-very-long-random-secret-key-here
```

### 2. HTTPS automatique

Render active automatiquement HTTPS pour tous les domaines.

### 3. Domaine personnalis√©

1. Onglet **Settings** de votre service
2. **Custom Domains**
3. Ajoutez votre domaine
4. Configurez les DNS selon les instructions

## üìä Monitoring et logs

### Voir les logs de d√©ploiement

1. Onglet **Events** : Historique des d√©ploiements
2. Onglet **Logs** : Logs en temps r√©el
3. **Build logs** : Logs de construction Docker

### Commandes utiles

```bash
# Voir les logs de l'application
# (Directement dans l'interface Render)

# Ex√©cuter des commandes dans le conteneur
# Utiliser le shell Render ou des scripts de d√©ploiement
```

## üêõ D√©pannage

### Probl√®mes courants

#### 0. **Dockerfile introuvable**

**Sympt√¥mes** : `Service Root Directory "/opt/render/project/src/Dockerfile.render" is missing`

**Cause** : Render ne trouve pas le Dockerfile au bon endroit.

**Solutions** :
1. **V√©rifiez la structure de votre repository** :
   ```
   votre-repo/
   ‚îú‚îÄ‚îÄ Dockerfile.render    ‚Üê Doit √™tre √† la racine
   ‚îú‚îÄ‚îÄ render.yaml
   ‚îî‚îÄ‚îÄ noMoreBook/          ‚Üê Votre application Symfony
       ‚îú‚îÄ‚îÄ src/
       ‚îú‚îÄ‚îÄ public/
       ‚îî‚îÄ‚îÄ composer.json
   ```

2. **Dans render.yaml, utilisez** :
   ```yaml
   dockerfilePath: Dockerfile.render  # Sans "./"
   dockerContext: .                   # Racine du projet
   ```

3. **V√©rifiez avec le diagnostic** :
   ```bash
   ./render-diagnostic.sh
   ```

4. **Si le probl√®me persiste** :
   - Assurez-vous que tous les fichiers sont committ√©s sur GitHub
   - V√©rifiez que la branche `main` est √† jour
   - Essayez de recr√©er le service Web sur Render

#### 1. **Erreur de connexion √† la base de donn√©es**

**Sympt√¥mes** : `Connection refused` ou `Unknown database`

**Solutions** :
- V√©rifiez que `DATABASE_URL` est correctement li√©e
- Attendez que la base de donn√©es soit compl√®tement initialis√©e
- V√©rifiez les logs de la base de donn√©es

#### 2. **√âchec des migrations**

**Sympt√¥mes** : `Table already exists` ou `Migration failed`

**Solutions** :
```bash
# Dans le script de d√©ploiement, ajoutez :
php bin/console doctrine:migrations:status
php bin/console doctrine:schema:validate
```

#### 3. **Assets non trouv√©s**

**Sympt√¥mes** : CSS/JS non charg√©s

**Solutions** :
- V√©rifiez que `npm run build` s'ex√©cute correctement
- V√©rifiez les permissions sur `/public/build`

#### 4. **Timeout de d√©ploiement**

**Solutions** :
- Optimisez le Dockerfile (cache des layers)
- R√©duisez la taille des d√©pendances
- Utilisez un plan payant pour plus de ressources

### Commandes de debug

```bash
# V√©rifier la configuration Symfony
php bin/console debug:config

# V√©rifier les routes
php bin/console debug:router

# V√©rifier la base de donn√©es
php bin/console doctrine:migrations:status
```

## ‚ö° Optimisations

### 1. Performance

```dockerfile
# Dans Dockerfile.render, optimisez :
RUN composer install --no-dev --optimize-autoloader --classmap-authoritative
RUN npm ci --only=production && npm run build
```

### 2. Caching

```env
# Variables pour le cache Redis (plan payant)
REDIS_URL=redis://user:pass@redis-host:port
```

### 3. Monitoring

```env
# Ajouter des outils de monitoring
NEW_RELIC_LICENSE_KEY=your-key
SENTRY_DSN=your-sentry-dsn
```

## üîÑ Workflow de d√©veloppement

### 1. D√©veloppement local

```bash
# Tester localement avec Docker
docker build -f Dockerfile.render -t nomorebook-render .
docker run -p 8080:80 nomorebook-render
```

### 2. D√©ploiement automatique

Render red√©ploie automatiquement √† chaque push sur la branche `main`.

### 3. Environnements multiples

Cr√©ez des branches pour diff√©rents environnements :
- `main` ‚Üí Production
- `staging` ‚Üí Staging
- `develop` ‚Üí D√©veloppement

## üìû Support

### Ressources utiles

- [Documentation Render](https://render.com/docs)
- [Symfony on Render](https://render.com/docs/deploy-symfony)
- [Docker on Render](https://render.com/docs/docker)

### En cas de probl√®me

1. V√©rifiez les logs Render
2. Testez localement avec Docker
3. Contactez le support Render
4. Consultez la communaut√© Symfony

---

## ‚úÖ Checklist de d√©ploiement

- [ ] Repository Git configur√©
- [ ] Base de donn√©es PostgreSQL cr√©√©e
- [ ] Variables d'environnement configur√©es
- [ ] Service web cr√©√© et configur√©
- [ ] D√©ploiement r√©ussi
- [ ] Application accessible via HTTPS
- [ ] Migrations ex√©cut√©es
- [ ] Tests de fonctionnement OK

**üéâ F√©licitations ! Votre application NoMoreBooking est maintenant en ligne sur Render !**
